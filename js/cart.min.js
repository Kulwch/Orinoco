let productsId=[];function displayCart(){const elt=document.querySelector("#cart");let products=JSON.parse(localStorage.getItem("products")),total=0,prices=[];if(localStorage.getItem("products"))for(let i=0;i<products.length;i++){elt.innerHTML+=`\n            <div class="col-4 col-md-3 col-lg-2 cartItem${products[i].tagKey}">\n                <a href="product.html?${products[i].productId}" class="text-decoration-none productLink">\n                    <img class="card-img-top img-fluid" src="${products[i].image}" alt="Oh le joli nounours !"/>\n                    <div class="card-body teddyInfos text-dark">\n                        <h5 class="card-title name">${products[i].name}</h5>\n                        <p class="color">Couleur: ${products[i].option}</p>\n                        <p class="quantity">Quantité: ${products[i].quantity}</p> \n                        <p class="price">Prix: ${products[i].price}.00 &euro;</p>\n                        <button class="btn btn-warning btnRemove">Enlever cet article</button>\n                    </div>\n                </a>                               \n            </div>\n            `,prices.push(`${products[i].price}`),productsId.push(`${products[i].productId}`),btnRemove=document.querySelectorAll(".btnRemove");for(let j=0;j<btnRemove.length;j++)btnRemove[j].addEventListener("click",e=>{e.preventDefault();let itemToRemove=`${products[j].tagKey}`;products=products.filter(element=>element.tagKey!==itemToRemove),localStorage.setItem("products",JSON.stringify(products)),window.location.reload()})}else elt.innerHTML="Votre panier est vide";total=prices.map(x=>parseInt(x,10)).reduce((total,num)=>total+num,0),localStorage.setItem("total",total);const totalPrice=document.querySelector(".totalPrice");totalPrice.innerHTML=`${total},00 &euro;`}function clearCart(){"true"!=localStorage.getItem("product")&&(localStorage.clear(),window.location.reload())}function disallowOrder(){document.getElementById("orderCart").disabled=!0,document.getElementById("orderForm").insertAdjacentHTML("beforeend","<p>Commande impossible, le formulaire n'est pas complet ou a mal été saisi. Veuillez rafraîchir la page et recommencer.</p>")}function order(){const firstName=document.getElementById("firstName").value,lastName=document.getElementById("lastName").value,address=document.getElementById("address").value,city=document.getElementById("city").value,email=document.getElementById("email").value,contact={firstName:firstName,lastName:lastName,address:address,city:city,email:email};let products,orderContent={};if(orderContent={contact:contact,products:productsId},0==localStorage.getItem("total"))document.getElementById("orderForm").insertAdjacentHTML("beforeend","<p>Impossible de commander un panier vide.</p>");else if(firstName.match("^[a-zA-Z'-]+$"))if(lastName.match("^[a-zA-Z'-]+$")){if(email.match("^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+.[a-zA-Z0-9-.]+$"))return fetch("http://localhost:3000/api/teddies/order",{method:"POST",body:JSON.stringify(orderContent),headers:{"Content-Type":"application/json"}}).then(response=>response.json()).then(res=>localStorage.setItem("orderId",res.orderId)).then(()=>window.location="confirm.html").catch(error=>{console.log("Erreur de connexion au serveur",error)});disallowOrder(),document.getElementById("orderForm").insertAdjacentHTML("beforeend","<p>Champ concerné: email.</p>")}else disallowOrder(),document.getElementById("orderForm").insertAdjacentHTML("beforeend","<p>Champ concerné: nom.</p>");else disallowOrder(),document.getElementById("orderForm").insertAdjacentHTML("beforeend","<p>Champ concerné: prénom.</p>")}